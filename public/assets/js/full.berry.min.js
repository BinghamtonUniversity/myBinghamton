Berry=function(t,e){this.destroy=function(){this.trigger("destroy"),this.each(function(){"function"==typeof this.destroy&&this.destroy()}),this.$el.empty();for(var t=this.fieldsets.length-1;t>=0;t--)$(this.fieldsets[t]).empty();"function"==typeof this.renderer.destroy&&this.renderer.destroy(),delete Berry.instances[this.options.name],this.trigger("destroyed")},this.toJSON=function(t,e){return this.attributes="string"==typeof t&&t.length>0?this.find(t).getValue():r.call(this,this.parsefields(this.options)),(e||"undefined"==typeof valid&&this.options.validate||!this.valid)&&this.validate(!0),this.attributes};var i=function(t,e){return this.each(function(t){if(this.multiple){var e=this.multiple.min||1;if("undefined"!=typeof t){var i=Berry.search(t,this.getPath()),s=0;null!==i&&(s=i.length),s>e&&(e=s)}var n=!0,r=this.fields;if(this.parent&&(r=this.parent.children),r[this.name])for(;this.owner.find(this.getPath()).length<e&&n;)n=this.clone()}},[t],e),this.each(function(t){if(this.multiple){var e=this.multiple.min||1;if("undefined"!=typeof t){var i=Berry.search(t,this.getPath()),s=0;null!==i&&(s=i.length),s>e&&(e=s)}var n=!0,r=this.fields;if(this.parent&&(r=this.parent.children),r[this.name])for(;this.owner.find(this.getPath()).length<e&&n;)n=this.clone()}},[t],e),t};this.populate=function(t,e){this.each(function(t){if(!this.isContainer){var e=Berry.search(t,this.getPath());this.setValue(e),this.trigger("change"),this.toJSON()}},[t],e)},this.each=function(t,e,i){i=i||this.fields;var s=!0;for(var n in i){if(s===!1)break;var r=i[n];r.item&&r.isActive()?s=t.apply(r,e):$.isEmptyObject(r.instances)||(s=this.each(t,e,r.instances)),$.isEmptyObject(r.children)||(s=this.each(t,e,r.children))}return s&&"undefined"!=typeof e?e:s},this.find=function(t,e){var i=[];return this.each(function(t,e){(this.getPath()==t||this.name==t)&&e.push(this)},[t,i],e),0==i.length?!1:i.length>1||i[0].multiple?i:i[0]},this.findByID=function(t,e){var i=[];return this.each(function(t,e){this.id==t&&e.push(this)},[t,i],e),i[0]},this.processfields=function(t,e,i){for(var s in t)var n=this.createField(Berry.normalizeItem(t[s],s,this.options.default),e,i)},this.createField=function(t,e,i,n){void 0!==e[0]&&(e=e[0]);var r=s.call(this,t,i,e,n);if("undefined"==typeof r.fieldset&&(r.fieldset=e),"before"==n)$(e).before(r.render());else if("after"==n)$(e).after(r.render());else if("fieldset"!==r.type||r.isChild()||!this.sectionsEnabled){var a;if("undefined"!=typeof $(r.fieldset).children(".row").last().attr("id")&&(a=h[$(r.fieldset).children(".row").last().attr("id")]),"undefined"==typeof a||a.used+parseInt(r.columns,10)+parseInt(r.offset,10)>this.options.columns){var o=Berry.getUID();a={},a.used=0,a.ref=$(Berry.render("berry_row",{id:o})),h[o]=a,$(r.fieldset).append(a.ref)}a.used+=parseInt(r.columns,10),a.used+=parseInt(r.offset,10),a.ref.append($("<div/>").addClass("col-md-"+r.columns).addClass("col-md-offset-"+r.offset).append(r.render()))}else $(r.fieldset).append(r.render());return r.initialize(),r};var s=function(t,e,i){var s=new Berry.types[t.type](t,this);s.parent=e;var n=this.fields;null!==e&&void 0!==e&&(n=e.children);var r=void 0!==n[s.name];if(s.isContainer){r||(n[s.name]={isContainer:!0,multiple:s.multiple,hasChildren:!$.isEmptyObject(t.fields),instances:[]});var a=n[s.name].instances.length,h=$(i).attr("id");for(var o in n[s.name].instances)if(n[s.name].instances[o].id==h){a=parseInt(o,10)+1;break}n[s.name].instances.splice(a,0,s);var l=0;for(var d in n[s.name].instances)n[s.name].instances[d].instance_id=l++}else if(r||s.multiple){if(n[s.name].isContainer){var f=[];f.push(n[s.name]),f=n[s.name],n[s.name]={multiple:s.multiple,hasChildren:!$.isEmptyObject(t.fields),instances:[]},n[s.name].instances.push(f)}else if(n[s.name]instanceof Berry.field){var f=[];f.push(n[s.name]),f=n[s.name],n[s.name]={instances:[]},n[s.name].instances.push(f)}n[s.name].instances.push(s)}else n[s.name]=s;return s};this.parsefields=function(t){var e={};return this.each(function(t,e){if(this.isParsable){var i;if(i=!this.isChild()||e.flatten&&"undefined"==typeof this.parent.multiple?t:Berry.search(t,this.parent.getPath()),this.isContainer)this.multiple?this.isChild()&&this.parent.multiple&&$.isArray(i)?("undefined"==typeof i[this.parent.instance_id]&&(i[this.parent.instance_id]={}),i[this.parent.instance_id][this.name]=i[this.parent.instance_id][this.name]||[]):i[this.name]=i[this.name]||[]:e.flatten||(this.isChild()&&this.parent.multiple&&$.isArray(i)?("undefined"==typeof i[this.parent.instance_id]&&(i[this.parent.instance_id]={}),i[this.parent.instance_id][this.name]={}):i[this.name]={});else{var s=this.getValue();null===s&&(s=""),$.isArray(i)?(i[this.parent.instance_id]||(i[this.parent.instance_id]={}),i[this.parent.instance_id][this.name]=s):i[this.name]=s}}},[e,t]),e},this.setActions=function(t){if(this.options.actionTarget||(this.options.actionTarget=$('<div class="berry-actions" style="overflow:hidden;padding-bottom:10px"></div>'),this.target.append(this.options.actionTarget)),this.options.actionTarget.empty(),t){t=containsKey(Berry.btn,t);for(var e in t){t[e].form=this.options.name;var i=$(Berry.render("berry__action",t[e]));"function"==typeof t[e].click&&i.click($.proxy(t[e].click,this)),this.options.actionTarget.append(i)}}};var n=function(t){var e={};return this.each(function(t,e){var i;i=this.isContainer?this.multiple?t[this.name]||[]:{}:t[this.name],this.isChild()?this.parent.multiple||(Berry.search(e,this.parent.getPath())[this.name]=i):e[this.name]=i},[t,e]),e},r=function(t){var e=$.extend(!0,{},t);return this.each(function(t,e){if(this.multiple&&this.toArray){var i=t,s=Berry.search(i,this.getPath());this.isChild()&&(i=Berry.search(e,this.parent.getPath())),i[this.name]={};for(var n in this.children)i[this.name][n]=$.pluck(s,n)}},[t,e]),e},a=function(t){var e=$.extend(!0,{},t);return this.each(function(t,e){if(this.isContainer&&this.multiple&&this.toArray){for(var i=Berry.search(e,this.parent.getPath()),s=i[this.name],n=[],r=0;r>=0&&20>r;){for(var a in s){if(!(s[a].length>r)){r=-2;break}n[r]=n[r]||{},n[r][a]=s[a][r]}r++}i[this.name]=n}},[t,e]),e};this.load=function(t){"undefined"!=typeof t.attributes?"string"==typeof t.attributes?$.ajax({url:this.options.attributes,method:"GET",success:$.proxy(function(e){this.options.attributes=e,t=this.options,t.flatten&&(t.attributes=n.call(this,t.attributes)),this.populate(i.call(this,a.call(this,t.attributes)))},this)}):(t.flatten&&(t.attributes=n.call(this,t.attributes)),this.populate(i.call(this,a.call(this,t.attributes)))):i.call(this),this.each(function(){this.isContainer||this.trigger("change")}),t.autoFocus&&this.each(function(){return this.isContainer?void 0:(this.focus(),!1)}),this.trigger("loaded")},this.$el=e,this.section_count=0,this.sectionsEnabled=!1,this.sections=[],this.sectionList=[],this.initialized=!1;var h={};this.fieldsets=[],this.fields={},this.options=$.extend({name:Berry.getUID()},Berry.options,t),this.events=$.extend(!0,{},Berry.prototype.events),this.trigger("initialize"),"undefined"==typeof this.$el&&(this.$el=$("<div/>")),this.renderer=new Berry.renderers[this.options.renderer](this),this.target=this.renderer.render(),this.options.legend&&this.options.legendTarget&&this.options.legendTarget.append(this.options.legend),this.processfields(this.options.fields,this.target,null),this.setActions(this.options.actions),"function"==typeof this.renderer.initialize&&this.renderer.initialize(),this.$el.find("form").on("submit",$.proxy(function(){this.trigger("save")},this)),"undefined"!=typeof Berry.instances[this.options.name]?(Berry.instances[this.options.name].on("destroyed",$.proxy(function(){Berry.instances[this.options.name]=this,this.initialized=!0,this.load(this.options),this.trigger("initialized")},this)),Berry.instances[this.options.name].destroy()):(Berry.instances[this.options.name]=this,this.initialized=!0,this.load(this.options),this.trigger("initialized"))},Berry.normalizeItem=function(t,e,i){if("string"==typeof t&&(t={type:t,label:e}),$.isArray(t)&&(t={options:t,label:e}),t=$.extend({},i,t),"undefined"!=typeof t.name&&0!==t.name.length||t.isContainer||(t.name="undefined"==typeof t.label||isNaN(parseFloat(e))?"undefined"!=typeof t.id?t.id:e.toLowerCase().split(" ").join("_"):t.label.toLowerCase().split(" ").join("_")),"undefined"==typeof t.label&&t.label!==!1&&(t.label=e),t.required?$.extend(t,{validate:{required:!0}}):"undefined"!=typeof t.validate&&(t.required=t.validate.required),"undefined"==typeof Berry.types[t.type]){var s=0;switch("undefined"!=typeof t.choices&&(s=t.choices.length),"undefined"!=typeof t.options&&(s=t.options.length),s){case 0:t.type="undefined"==typeof t.fields?"text":"fieldset";break;case 2:t.falsestate=t.options[1].toLowerCase().split(" ").join("_");case 1:t.type="checkbox",t.truestate=t.options[0].toLowerCase().split(" ").join("_");break;case 3:case 4:t.type="radio";break;default:t.type="select"}}return t}; Berry.field=function(t,i){this.children={},this.owner=i,this.hidden=!1,this.item=$.extend(!0,{},this.defaults,t),this.owner.trigger("initializeField",{field:this}),$.extend(this,this.owner.options,this.item),0!==this.item.value?"function"==typeof t.value?(this.valueFunc=t.value,this.liveValue=function(){return this.valueFunc.call(this.owner.toJSON())},t.value=this.item.value=this.liveValue(),this.owner.on("change",$.proxy(function(){this.set(this.liveValue())},this))):"string"==typeof this.item.value&&0===this.item.value.indexOf("=")&&"undefined"!=typeof math?(this.formula=this.item.value.substr(1),this.enabled=!1,this.liveValue=function(){try{var t=math.eval(this.formula,this.owner.toJSON());return $.isNumeric(t)?t.toFixed(this.item.precision||0):t}catch(i){return this.formula}},t.value=this.item.value=this.liveValue(),this.owner.on("change",$.proxy(function(){this.set(this.liveValue())},this))):this.value=t.value||this.value||t.default||"":this.value=0,this.lastSaved=this.liveValue(),this.id=t.id||Berry.getUID(),this.self=void 0,this.fieldset=void 0,"object"!=typeof this.item.fieldset?void 0!==this.item.fieldset&&$("."+this.item.fieldset).length>0?(this.fieldset=$("."+this.item.fieldset)[0],this.owner.fieldsets.push(this.fieldset)):void 0!==this.item.fieldset&&$("[name="+this.item.fieldset+"]").length>0&&(this.fieldset=$("[name="+this.item.fieldset+"]")[0],this.owner.fieldsets.push(this.fieldset)):this.item.fieldset.length&&(this.fieldset=this.item.fieldset),this.val=function(t){return"undefined"!=typeof t&&this.set(t),this.getValue()},this.columns=this.columns||this.owner.options.columns,this.columns>this.owner.options.columns&&(this.columns=this.owner.options.columns)},$.extend(Berry.field.prototype,{type:"text",offset:0,version:"1.0",isContainer:!1,isParsable:!0,isVisible:!0,isEnabled:!0,instance_id:null,path:"",defaults:{},parent:null,getPath:function(t){var i="";return null!==this.parent&&void 0!==this.parent&&(i=this.parent.getPath(t)+".",(this.parent.multiple||t)&&(i+=this.parent.instance_id+".")),i+this.name},isActive:function(){return null===this.parent||this.parent.isEnabled!==!1},isChild:function(){return null!==this.parent},set:function(t){this.value!=t&&(this.setValue(t),this.trigger("change"))},revert:function(){return this.item.value=this.lastSaved,this.setValue(this.lastSaved),this},hasChildren:function(){return!$.isEmptyObject(this.children)},create:function(){return Berry.render("berry_"+(this.elType||this.type),this)},render:function(){return"undefined"==typeof this.self?this.self=$(this.create()).attr("data-Berry",this.owner.options.name):this.self.html($(this.create()).html()),this.display=this.getDisplay(),this.self},getValue:function(){return this.$el.val()},toJSON:function(){return this.value=this.getValue(),this.lastSaved=this.value,this.display=this.getDisplay(),this.lastSaved},liveValue:function(){return this.value},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",$.proxy(function(){this.trigger("change")},this)),this.item.mask&&$.fn.mask&&this.$el.mask(this.item.mask)},initialize:function(){this.setup(),"undefined"!=typeof this.show&&(this.isVisible="undefined"==typeof this.show||$.isEmptyObject(this.show),this.self.toggle(this.isVisible),this.showConditions=Berry.processConditions.call(this,this.show,function(t,i){if("boolean"==typeof t){this.showConditions[i]=t,this.isVisible=!0;for(var e in this.showConditions)if(!this.showConditions[e]){this.isVisible=!1;break}this.self.toggle(this.isVisible)}}),"boolean"==typeof this.showConditions&&(this.self.toggle(this.showConditions),this.isVisible=this.showConditions,this.update({},!0))),"undefined"!=typeof this.enabled&&(this.enabledConditions=Berry.processConditions.call(this,this.enabled,function(t,i){if("boolean"==typeof t){this.enabledConditions[i]=t,this.isEnabled=!0,this.enable();for(var e in this.enabledConditions)if(!this.enabledConditions[e]){this.isEnabled=!1,this.disable();break}}}),"boolean"==typeof this.enabledConditions&&(this.isEnabled=this.enabledConditions,this.update({},!0))),"undefined"!=typeof this.parsable&&(this.parsableConditions=Berry.processConditions.call(this,this.parsable,function(t,i){if("boolean"==typeof t){var e=this.isParsable;this.parsableConditions[i]=t,this.isParsable=!0;for(var s in this.parsableConditions)if(!this.parsableConditions[s]){this.isParsable=!1;break}e!==this.isParsable&&this.trigger("change")}}),"boolean"==typeof this.parsableConditions&&(this.isParsable=this.parsableConditions)),this.owner.trigger("initializedField",{field:this})},on:function(t,i){this.owner.on(t+":"+this.name,i)},delay:function(t,i){this.owner.delay(t+":"+this.name,i)},trigger:function(t){this.value=this.getValue(),this.owner.trigger(t+":"+this.name,{id:this.id,value:this.value})},setValue:function(t){return"object"!=typeof t?("undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.$el.val(t)):this.value},update:function(t,i){"object"==typeof t&&$.extend(this.item,t),$.extend(this,this.item),this.setValue(this.value),this.render(),this.setup(),i||this.trigger("change")},blur:function(){this.$el.blur()},focus:function(){this.$el.focus().val("").val(this.value)},disable:function(){this.$el.prop("disabled",!0)},enable:function(){this.$el.prop("disabled",!1)},satisfied:function(){return"undefined"!=typeof this.value&&null!==this.value&&""!==this.value},displayAs:function(){return this.lastSaved},getDisplay:function(){return void 0!==this.displayAs?void 0!==this.item.template?(this.display=this.displayAs(),Berry.render(this.item.template,this)):this.displayAs()||this.item.default||this.item.value||"Empty":void 0!==this.item.template?Berry.render(this.item.template,this):this.lastSaved||this.item.default||this.item.value||"Empty"},destroy:function(){this.$el&&this.$el.off()}}),Berry.field.extend=function(t){var i=this,e=function(){return i.apply(this,arguments)},s=function(){this.constructor=e};return s.prototype=i.prototype,e.prototype=new s,t&&$.extend(e.prototype,t),e}; Berry.prototype.events={initialize:[]},Berry.prototype.addSub=function(t,e){this.events[t]||(this.events[t]=[]);var i=Berry.getUID();return this.events[t].push({token:i,func:e}),i},Berry.prototype.on=function(t,e,i,s){var n=/\s+/;if(n.test(t)){var r=t.split(n);for(var o in r)"undefined"!=typeof i?this.addSub(r[o],$.proxy(e,i)):this.addSub(r[o],e)}else this.lastToken="undefined"!=typeof i?this.addSub(t,$.proxy(e,i)):this.addSub(t,e);return s&&e.call(this,null,t),this},Berry.prototype.delay=function(t,e,i,s,n){var r=function(t,e,s){clearTimeout(this.events[s].timer),this.events[s].timer=setTimeout($.proxy(function(){this.events[s].func.call(this)},i||this),n||250)},o=/\s+/;if(o.test(t)){var h=t.split(o);for(var l in h)this.lastToken=this.addSub(h[l],r),this.events[this.lastToken]={func:e,timer:null}}else this.lastToken=this.addSub(t,r),this.events[this.lastToken]={func:e,timer:null};return s&&e.call(i||this,null,t),this},Berry.prototype.off=function(t){for(var e in this.events)if(this.events[e])for(var i=0,s=this.events[e].length;s>i;i++)if(this.events[e][i].token===t)return this.events[e].splice(i,1),t;return this},Berry.prototype.trigger=function(t,e){if(this.events[t])for(var i=this.events[t],s=i?i.length:0;s--;)i[s].func.call(this,e,t,i[s].token);if(newtopic=t.split(":")[0],newtopic!==t&&(t=newtopic,this.events[t]))for(var i=this.events[t],s=i?i.length:0;s--;)i[s].func.call(this,e,t,i[s].token);return this}; function containsKey(e,t){var i={};for(var n in t)"undefined"!=typeof e[t[n]]&&(i[t[n]]=e[t[n]]);return i}Berries=Berry.instances={},Berry.counter=0,Berry.types={},Berry.options={errorClass:"has-error",errorTextClass:"font-xs.text-danger",inline:!1,modifiers:"",renderer:"base",flatten:!0,columns:12,autoDestroy:!0,autoFocus:!0,validate:!1,actions:["cancel","save"]},Berry.register=function(e){Berry.types[e.type]=e.extends&&"undefined"!=typeof Berry.types[e.extends]?Berry.types[e.extends].extend(e):Berry.field.extend(e)},Berry.search=function(e,t){t=t.replace(/\[(\w+)\]/g,".$1");for(var i=t.split(".");i.length;){var n=i.shift();"undefined"!=typeof e&&null!==e&&"string"!=typeof e&&n in e&&(e=e[n])}return e},Berry.collection=function(e){var t={};return this.events={initialize:[]},this.addSub=e.prototype.addSub,this.on=e.prototype.on,this.off=e.prototype.off,this.trigger=e.prototype.trigger,{add:function(e,i){t[e]=i},get:function(e){return t[e]},update:function(e,i){t[e]=i,this.trigger(e)}.bind(this),on:this.on.bind(this),off:this.off.bind(this)}}(Berry),Berry.processOpts=function(e,t){if("undefined"!=typeof e.max&&(e.min=e.min||0,e.choices=e.choices||[],0!=e.step&&e.min<=e.max))for(var i=e.min;i<=e.max;i+=e.step||1)e.choices.push(i.toString());if("function"==typeof e.choices&&(e.options=e.choices.call(this,e)),"undefined"!=typeof e.choices&&e.choices.length>0){if("string"==typeof e.choices){if(e.optionPath=e.choices,"undefined"==typeof Berry.collection.get(e.optionPath))return Berry.collection.add(e.optionPath,[]),function(t){$.ajax({url:e.optionPath,type:"get",success:function(i){Berry.collection.on(e.optionPath,function(e,t){this.item.waiting=!1,this.update({choices:Berry.collection.get(t),options:Berry.collection.get(t)}),this.parent&&this.parent.multiple&&"undefined"!=typeof this.owner&&this.update({value:Berry.search(this.owner.options.attributes,this.getPath())})}.bind(t)),Berry.collection.update(e.optionPath,i)}})}(t),e.waiting=!0,e.options=[],e;Berry.collection.on(e.optionPath,function(e,t){this.item.waiting=!1,this.update({choices:Berry.collection.get(t),options:Berry.collection.get(t)}),this.parent&&this.parent.multiple&&"undefined"!=typeof this.owner&&this.update({value:Berry.search(this.owner.options.attributes,this.getPath())})}.bind(t)),Berry.collection.get(e.optionPath).length&&(e.choices=Berry.collection.get(e.optionPath))}if("object"==typeof e.choices&&!$.isArray(e.choices))for(var n in conditions)Berry.conditions[n].call(this,this.owner,conditions[n],function(){});"object"==typeof e.choices&&(e.options=$.map(e.choices,function(e){return[e]}))}if("undefined"!=typeof e.default&&"undefined"!=typeof e.options&&e.options[0]!==e.default&&e.options.unshift(e.default),"undefined"!=typeof e.options&&e.options.length>0){for(var o in e.options){var r=e.options[o];("string"==typeof r||"number"==typeof r)&&(r={label:r},"index"!==e.value_key&&(r.value=r.label)),"undefined"!=typeof e.value_key&&""!==e.value_key&&(r.value="index"===e.value_key?o:r[e.value_key]),"undefined"==typeof r.value&&(r.value=r.id),"undefined"!=typeof e.label_key&&""!==e.label_key&&(r.label=r[e.label_key]),"undefined"==typeof r.label&&(r.label=r.label||r.name||r.title),e.options[o]=r,"undefined"!=typeof e.value&&""!==e.value&&(e.options[o].selected=$.isArray(e.value)?$.inArray(r.value,e.value)>-1:r.value==e.value)}}return e},Berry.getUID=function(){return"b"+Berry.counter++},Berry.render=function(e,t){return(templates[e]||templates.berry_text).render(t,templates)},Berry.register({type:"fieldset",getValue:function(){return null},create:function(){return this.name=this.name||Berry.getUID(),"undefined"!=typeof this.multiple&&(this.multiple.min=this.multiple.min||1,"undefined"!=typeof this.multiple.max&&(this.multiple.max>this.multiple.min?this.multiple.duplicate=!0:this.multiple.min>this.multiple.max&&(this.multiple.min=this.multiple.max))),this.isChild()||(++this.owner.section_count,this.owner.sections.push(this),this.owner.sectionList.push({index:this.owner.section_count,text:this.item.legend||this.item.label,state:"disabled",completed:!1,active:!1,error:!1})),this.owner.fieldsets.push($('[name="'+this.name+'"]')[0]),this.owner.renderer.fieldset(this)},focus:function(){return this.owner.each(function(){return this.focus(),!1},{},this.children),!1},setValue:function(){return!0},setup:function(){return void 0!==this.fields?this.owner.processfields(this.fields,this.self,this):void 0},isContainer:!0}),Berry.renderers={base:function(e){this.owner=e,this.initialize=function(){$(this.owner.$el).keydown($.proxy(function(e){switch(e.keyCode){case 27:$("#close").click();break;case 13:e.ctrlKey&&this.owner.$el.find("[data-id=berry-submit]").click()}},this))},this.fieldset=function(e){return Berry.render("berry_"+this.owner.options.renderer+"_fieldset",e)},this.destroy=function(){$(this.owner.$el).off(),this.owner.$el.empty()},this.render=function(){return this.owner.$el.html(Berry.render("berry_"+this.owner.options.renderer+"_form",this.owner.options)),this.owner.$el.find("form")}}},Berry.btn={save:{label:"Save",icon:"check",id:"berry-submit",modifier:"success pull-right",click:function(){this.options.autoDestroy&&this.on("saved",this.destroy),this.trigger("save")}},cancel:{label:"Cancel",icon:"times",id:"berry-close",modifier:"default pull-left",click:function(){this.options.autoDestroy&&this.destroy(),this.trigger("cancel")}}},Berry.prototype.events.save=[{token:Berry.getUID(),func:function(){"string"==typeof this.options.action&&this.validate()&&(this.trigger("saveing"),$.ajax({url:this.options.action,data:this.toJSON(),method:this.options.method||"POST",success:$.proxy(function(e){this.trigger("saved",e)},this)}))}}],Berry.prototype.sum=function(e){var t=this.toJSON(e),i=0;if("object"==typeof t){for(var n in t)i+=parseInt(t[n],10)||0;return i}return t},$(function(e){e.fn.berry=function(e){return new Berry(e,this)}}(jQuery)),$.pluck=function(e,t){return $.map(e,function(e){return e[t]})}; Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){Berry.field.prototype.clone=function(){var e=this.multiple.max;if("undefined"==typeof e||e>this.parent.children[this.name].instances.length){{$.extend({},this.owner.options.default,this.item,{id:Berry.getUID(),name:this.name})}return this.owner.createField($.extend({},this.owner.options.default,this.item,{id:Berry.getUID(),name:this.name}),$(this.self),this.parent,"after"),this.trigger("change"),!0}return!1},Berry.field.prototype.remove=function(){if((this.multiple.min||1)<this.owner.find(this.getPath()).length){$(this.self).empty().remove(),this.trigger("dropped");var e=this.owner.fields;this.isChild()&&(e=this.parent.children),e[this.name].instances.splice(this.instance_id,1);var i=0,t=this.owner.find(this.getPath());for(var n in t)t[n].instance_id=i++;return this.trigger("change"),!0}return!1},this.on("initializedField",function(e){e.field.multiple&&e.field.multiple.duplicate&&(e.field.self.find(".duplicate").on("click",$.proxy(e.field.clone,e.field)),e.field.self.find(".remove").on("click",$.proxy(e.field.remove,e.field)))})}}); Berry.processConditions=function(n,e){if("string"==typeof n&&("show"===n||"enabled"===n||"parsable"===n?n=this.item[n]:"enable"===n&&(n=this.item.enable)),"boolean"==typeof n)return n;if("object"==typeof n){var t=[];for(var o in n)t.push(Berry.conditions[o].call(this,this.owner,n[o],e||n[o].callBack));return t}return!0},Berry.conditions={requires:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,o,r){t.call(this,null!==e.value&&""!==e.value,r)},this,e)).lastToken},not_matches:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,o,r){t.call(this,n.value!==e.value,r)},this,e)).lastToken},matches:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,o,r){t.call(this,n.value===e.value,r)},this,e)).lastToken},test:function(n,e,t){return n.on("change:"+this.name,$.proxy(function(n,e,o,r){t.call(this,n(),r)},this,e)).lastToken},multiMatch:function(n,e,t){return berry.on("change:"+_.pluck(e,"name").join(" change:"),$.proxy(function(n){t.call(this,function(n,e){var t=!1;for(var o in n){var r=n[o].value,a=e.toJSON()[n[o].name];if(t="object"==typeof r&&null!==a?-1!==r.indexOf(a):r==a,!t)break}return t}(n,berry),"mm")},this,e)),"mm"}}; Berry.prototype.valid=!0,Berry.prototype.validate=function(e){return e||this.toJSON(),this.clearErrors(),this.each(this.validateItem),this.valid},Berry.prototype.validateItem=function(){this.owner.performValidate(this),this.owner.errors[this.item.name]=this.errors,this.owner.valid=this.valid&&this.owner.valid},Berry.prototype.performValidate=function(e,r){var t=e.item,a=e.value;if("undefined"!=typeof r&&(a=r),e.valid=!0,e.errors="","undefined"!=typeof t.validate&&"object"==typeof t.validate)for(var i in t.validate){if(!Berry.validations[i].method.call(e,a,t.validate[i])&&("undefined"==typeof t.show||e.isVisible)){e.valid=!1;var s=Berry.validations[i].message;"string"==typeof t.validate[i]&&(s=t.validate[i]),e.errors=s.replace("{{label}}",t.label)}e.self.toggleClass(e.owner.options.errorClass,!e.valid),e.self.find("."+e.owner.options.errorTextClass).html(e.errors)}},Berry.prototype.errors={},Berry.prototype.clearErrors=function(){this.valid=!0,this.errors={},this.$el.find("."+this.options.errorClass).removeClass(this.options.errorClass).find("."+this.options.errorTextClass).html("")},Berry.regex={},Berry.regex.numeric=/^[0-9]+$/,Berry.regex.integer=/^\-?[0-9]+$/,Berry.regex.decimal=/^\-?[0-9]*\.?[0-9]+$/,Berry.regex.email=/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i,Berry.regex.alpha=/^[a-z]+$/i,Berry.regex.alphaNumeric=/^[a-z0-9]+$/i,Berry.regex.alphaDash=/^[a-z0-9_-]+$/i,Berry.regex.natural=/^[0-9]+$/i,Berry.regex.naturalNoZero=/^[1-9][0-9]*$/i,Berry.regex.ip=/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i,Berry.regex.base64=/[^a-zA-Z0-9\/\+=]/i,Berry.regex.url=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,Berry.regex.date=/^(0[1-9]|1[0-2])\/(0[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}$/,Berry.validations={required:{method:function(){return this.satisfied()},message:"The {{label}} field is required."},matches:{method:function(e,r){return el==this.Berry[r]?e===el.value:!1},message:"The {{label}} field does not match the %s field."},valid_email:{method:function(e){return Berry.regex.email.test(e)||""===e},message:"The {{label}} field must contain a valid email address."},valid_emails:{method:function(e){for(var r=e.split(","),t=0;t<r.length;t++)if(!Berry.regex.email.test(r[t]))return!1;return!0},message:"The {{label}} field must contain all valid email addresses."},min_length:{method:function(e,r){return Berry.regex.numeric.test(r)?e.length>=parseInt(r,10):!1},message:"The {{label}} field must be at least %s characters in length."},max_length:{method:function(e,r){return Berry.regex.numeric.test(r)?e.length<=parseInt(r,10):!1},message:"The {{label}} field must not exceed %s characters in length."},exact_length:{method:function(e,r){return Berry.regex.numeric.test(r)?e.length===parseInt(r,10):!1},message:"The {{label}} field must be exactly %s characters in length."},greater_than:{method:function(e,r){return Berry.regex.decimal.test(e)?parseFloat(e)>parseFloat(r):!1},message:"The {{label}} field must contain a number greater than %s."},less_than:{method:function(e,r){return Berry.regex.decimal.test(e)?parseFloat(e)<parseFloat(r):!1},message:"The {{label}} field must contain a number less than %s."},alpha:{method:function(e){return Berry.regex.alpha.test(e)||""===e},message:"The {{label}} field must only contain alphabetical characters."},alpha_numeric:{method:function(e){return Berry.regex.alphaNumeric.test(e)||""===e},message:"The {{label}} field must only contain alpha-numeric characters."},alpha_dash:{method:function(e){return Berry.regex.alphaDash.test(e)||""===e},message:"The {{label}} field must only contain alpha-numeric characters, underscores, and dashes."},numeric:{method:function(e){return Berry.regex.decimal.test(e)||""===e},message:"The {{label}} field must contain only numbers."},integer:{method:function(e){return Berry.regex.integer.test(e)||""===e},message:"The {{label}} field must contain an integer."},decimal:{method:function(e){return Berry.regex.decimal.test(e)||""===e},message:"The {{label}} field must contain a decimal number."},is_natural:{method:function(e){return Berry.regex.natural.test(e)||""===e},message:"The {{label}} field must contain only positive numbers."},is_natural_no_zero:{method:function(e){return Berry.regex.naturalNoZero.test(e)||""===e},message:"The {{label}} field must contain a number greater than zero."},valid_ip:{method:function(e){return Berry.regex.ip.test(e)||""===e},message:"The {{label}} field must contain a valid IP."},valid_url:{method:function(e){return Berry.regex.url.test(e)||""===e},message:"The {{label}} field must contain a valid Url."},valid_base64:{method:function(e){return Berry.regex.base64.test(e)||""===e},message:"The {{label}} field must contain a base64 string."},date:{method:function(e){return Berry.regex.date.test(e)||""===e},message:"The {{label}} field should be in the format MM/DD/YYYY."}}; !function(t,e){t.register({type:"checkbox",defaults:{container:"span"},create:function(){return this.checkStatus(this.value),t.render("berry_checkbox",this)},checkStatus:function(t){this.value=t===!0||"true"===t||1===t||"1"===t||"on"===t||t==this.truestate?!0:!1},setup:function(){this.$el=this.self.find("[type=checkbox]"),this.$el.off(),void 0!==this.onchange&&this.on("change",this.onchange),this.$el.change(e.proxy(function(){this.trigger("change")},this))},getValue:function(){return this.$el.is(":checked")?this.truestate||!0:"undefined"!=typeof this.falsestate?this.falsestate:!1},setValue:function(t){this.checkStatus(t),this.$el.prop("checked",this.value),this.value=t},displayAs:function(){for(var t in this.item.options)if(this.item.options[t].value==this.lastSaved)return this.item.options[t].name},focus:function(){this.$el.focus()},satisfied:function(){return this.$el.is(":checked")}})}(Berry,jQuery); !function(t,i){t.register({type:"radio",create:function(){return this.options=t.processOpts.call(this.owner,this.item,this).options,t.render("berry_"+(this.elType||this.type),this)},setup:function(){this.$el=this.self.find("[type=radio]"),this.$el.off(),void 0!==this.onchange&&this.on("change",this.onchange),this.$el.change(i.proxy(function(){this.trigger("change")},this))},getValue:function(){if(this.item.waiting)return this.value;var t=this.self.find('[type="radio"]:checked').data("label");for(var i in this.item.options)if(this.item.options[i].label==t)return this.item.options[i].value},setValue:function(t){("object"!=typeof t&&this.item.waiting||"undefined"!=typeof _.findWhere(this.options,{value:t})||"undefined"!=typeof _.findWhere(this.options,{value:t+=""})||"undefined"!=typeof _.findWhere(this.options,{value:parseInt(t,10)}))&&("undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.self.find('[value="'+this.value+'"]').prop("checked",!0))},displayAs:function(){for(var t in this.item.options)if(this.item.options[t].value==this.lastSaved)return this.item.options[t].label},focus:function(){this.self.find('[type="radio"]:checked').focus()}})}(Berry,jQuery); !function(e,t){e.register({type:"select",create:function(){return this.options=e.processOpts.call(this.owner,this.item,this).options,e.render("berry_"+(this.elType||this.type),this)},setup:function(){this.$el=this.self.find("select"),this.$el.off(),this.setValue(this.value),void 0!==this.onchange&&this.on("change",this.onchange),this.$el.change(t.proxy(function(){this.trigger("change")},this))},displayAs:function(){var e=this.options;for(var t in e)if(e[t].value==this.lastSaved)return e[t].label},getValue:function(){return this.item.waiting?this.value:this.$el.val()},setValue:function(e){return("object"!=typeof e&&this.item.waiting||"undefined"!=typeof _.findWhere(this.options,{value:e})||"undefined"!=typeof _.findWhere(this.options,{value:e+=""})||"undefined"!=typeof _.findWhere(this.options,{value:parseInt(e,10)}))&&("undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.val(e)),this.value}})}(Berry,jQuery); !function(e,t){e.register({type:"text"}),e.register({type:"raw"}),e.register({type:"password"}),e.register({type:"date",setValue:function(e){return"object"!=typeof e?("undefined"!=typeof moment&&(e=moment.utc(e).format("YYYY-MM-DD")),"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.val(e)):this.value}}),e.register({type:"range"}),e.register({type:"hidden",create:function(){return'<div><input type="hidden"  name="'+this.name+'" value="'+this.value+'" /></div>'}}),e.register({type:"url",defaults:{post:'<i class="fa fa-link"></i>',validate:{valid_url:!0}}}),e.register({type:"phone",defaults:{mask:"(999) 999-9999",post:'<i class="fa fa-phone"></i>',placeholder:"+1"}}),e.register({type:"color",defaults:{pre:"<i></i>",type:"text"},setValue:function(e){return"object"!=typeof e?("undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.parent().colorpicker("setValue",this.value),this.$el.val(e)):this.value},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",t.proxy(function(){this.trigger("change")},this)),this.$el.attr("type","text"),this.$el.parent().colorpicker({format:"hex"}).on("changeColor",t.proxy(function(){this.trigger("change")},this))}}),e.register({type:"email",defaults:{post:'<i class="fa fa-envelope"></i>',validate:{valid_email:!0}}}),e.register({type:"number",defaults:{elType:"text"},value:0,getValue:function(){var e=this.$el.val();return""===e?0:t.isNumeric(e)?parseFloat(e,10):void 0},satisfied:function(){return"undefined"!=typeof this.value&&null!==this.value&&""!==this.value&&0!==this.value}}),e.register({type:"tags",defaults:{elType:"text"},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",t.proxy(function(){this.trigger("change")},this)),t.fn.tagsInput&&this.$el.tagsInput()},setValue:function(e){return"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.importTags(e),this.$el.val(e)}})}(Berry,jQuery); !function(t,e){t.register({type:"textarea","default":{autosize:!0,advanced:!1},setup:function(){this.$el=this.self.find("textarea"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",e.proxy(function(){this.trigger("change")},this)),this.item.advanced&&e.fn.htmlarea&&(this.$el.css({height:"300px"}).htmlarea({toolbar:this.item.toolbar||[["bold","italic","underline"],["superscript","subscript"],["justifyleft","justifycenter","justifyright"],["indent","outdent"],["orderedList","unorderedList"],["link","unlink"],["horizontalrule"]]}),this.$el.on("change",e.proxy(function(){this.trigger("change")},this))),this.autosize!==!1&&e.fn.autosize&&this.$el.autosize()},setValue:function(t){return"object"!=typeof t&&("undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.$el.val(t),this.autosize!==!1&&e.fn.autosize&&this.$el.trigger("autosize.resize"),this.item.advanced&&e.fn.htmlarea&&this.$el.htmlarea("updateHtmlArea",t)),this.$el},focus:function(){this.$el.focus().val("").val(this.value),this.self.find("iframe").focus()}})}(Berry,jQuery); Berry.backbone=!0,Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){if("undefined"!=typeof this.options.model){this.on("save",function(){return this.validate()&&(this.trigger("saveing"),this.options.model.set(this.toJSON()),this.trigger("saved")),this.valid});var t=this.options.model.schema,e={},i=this.options.fields;if("all"===i||"undefined"==typeof this.options.fields)this.options.fields=t;else{for(var s in i)"string"==typeof i[s]?"undefined"!=typeof t[i[s]]&&(e[i[s]]=t[i[s]]):e["key_"+s]=i[s];this.options.fields=e}("undefined"==typeof this.options.attributes||$.isEmptyObject(this.options.attributes))&&(this.options.attributes=this.options.model.toJSON(),this.options.model.on("change",function(){for(var t in this.options.model.changed){var e=this.find(t);e&&!$.isArray(e)&&e.set(this.options.model.changed[t])}},this),this.on("destroy",function(){this.options.model.off("change",null,this)}))}}}),Berry.register({type:"fieldset",getValue:function(){return null},create:function(){return this.name=this.name||Berry.getUID(),this.owner.fieldsets.push(this.name),this.isChild()||(++this.owner.section_count,this.owner.sections.push(this),this.owner.sectionList.push({index:this.owner.section_count,text:this.item.legend,state:"disabled",completed:!1,active:!1,error:!1})),this.owner.renderer.fieldset(this)},focus:function(){return this.owner.each(function(){return this.focus(),!1},{},this.children),!1},setValue:function(){return!0},setup:function(){"undefined"!=typeof this.fields&&this.owner.processfields(this.fields,this.self,this)},isContainer:!0}); Berry.extract=!0,Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){if("undefined"!=typeof this.options.template){var t=/\{\{\{?(.[\s\S]*?)\}\}\}?/g;text=this.options.template;var e=text,i=t.exec(text);for(this.options.fields=this.options.fields||{};null!=i;){var s=i[1].split(":{"),o="{{";if("!"==s[0].substr(0,1)&&(s[0]=s[0].substr(1),o+="!"),$.inArray(s[0].substr(0,1),["^","#","/",">"])<0){var n={};s.length>1&&(n=JSON.parse("{"+s[1])),this.options.fields[s[0]]=$.extend(this.options.fields[s[0]],n),e=e.replace(i[0],o+(this.options.fields[s[0]].name||s[0].toLowerCase().split(" ").join("_"))+"}}")}i=t.exec(text)}this.options.template=Hogan.compile(e)}}}); Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){"undefined"!=typeof this.$el&&this.$el.length||(this.autoDestroy=!1,this.$el=$("<div/>"),this.options.modal=this.options.modal||{},this.options.modal.header_class=this.options.modal.header_class||"bg-success",this.ref=$(Berry.render("modal",this.options)),$(this.ref).appendTo("body"),this.options.legendTarget=this.ref.find(".modal-title"),this.options.actionTarget=this.ref.find(".modal-footer"),this.$el=this.ref.find(".modal-body"),this.ref.modal(this.options.modal),this.ref.on("shown.bs.modal",$.proxy(function(){this.options.autoFocus&&this.$el.find(".form-control:first").focus()},this)),this.on("cancel",$.proxy(function(){this.ref.modal("hide")},this)),this.on("saved, close",$.proxy(function(){this.ref.modal("hide"),this.closeAction="save"},this)),this.ref.on("hidden.bs.modal",$.proxy(function(){this.closeAction=this.closeAction||"cancel",this.destroy()},this)),this.on("destroyed",$.proxy(function(){this.ref.modal("hide"),this.trigger("completed")},this)))}}); !function(e,t){e.register({type:"ace",create:function(){return e.render("berry_ace",this)},setup:function(){this.$el=this.self.find(".formcontrol > div"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",t.proxy(function(){this.trigger("change")},this)),this.editor=ace.edit(this.id+"container"),this.editor.setTheme(this.item.theme||"ace/theme/chrome"),this.editor.getSession().setMode(this.item.mode||"ace/mode/handlebars")},setValue:function(e){return"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.editor.setValue(e),this.$el},getValue:function(){return this.editor.getValue()},focus:function(){this.editor.focus()}})}(Berry,jQuery); !function(e){e.register({type:"base64",defaults:{elType:"file"},create:function(){return e.render("berry_text",this)},setup:function(){this.$el=this.self.find("input"),this.$el.off(),this.$el.on("change",_.partial(function(e,t){var r=this.files;window.FileReader?(!function(e,t){var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){this.set(e.target.result)}.bind(t),r.onerror=function(e){"NotReadableError"==e.target.error.name&&alert("Canno't read file !")}}(r[0],e),t.currentTarget.value=""):alert("FileReader is not supported in this browser.")},this))},setValue:function(e){return"object"!=typeof e?("undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.value):this.value},getValue:function(){return this.value}})}(Berry,jQuery); !function(t,e){t.register({type:"contenteditable",create:function(){return t.render("berry_contenteditable",this)},setup:function(){this.$el=this.self.find(".formcontrol > div"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",e.proxy(function(){this.trigger("change")},this)),tinymce.init({selector:".formcontrol > div",plugins:["autolink link code image"],inline:!0,toolbar1:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image"}),this.editor=tinyMCE.editors[tinyMCE.editors.length-1]},setValue:function(t){return"undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.editor.setContent(t),this.value=t,this.$el.html(t),this.$el},getValue:function(){return this.editor.getContent()}})}(Berry,jQuery),$(document).on("focusin",function(t){$(t.target).closest(".mce-window").length&&t.stopImmediatePropagation()}); !function(t,e){t.register({type:"custom_radio",create:function(){return this.options=t.processOpts.call(this.owner,this.item,this).options,t.render("berry_"+(this.elType||this.type),this)},defaults:{selectedClass:"btn-success",defaultClass:"btn-default"},setup:function(){this.$el=this.self.find(".custom-group"),this.$el.children(".btn").off(),this.$el.children(".btn").on("click",e.proxy(function(t){this.$el.children("."+this.selectedClass).toggleClass(this.selectedClass+" "+this.defaultClass),e(t.target).closest(".btn").toggleClass(this.selectedClass+" "+this.defaultClass),"function"==typeof this.onchange&&this.onchange(),this.trigger("change")},this))},getValue:function(){return this.$el.children("."+this.selectedClass).attr("data-value")},setValue:function(t){return this.$el.children('[data-value="'+t+'"]').click()}})}(Berry,jQuery); !function(t,e){t.register({type:"custom_select",create:function(){if(this.options=t.processOpts.call(this.owner,this.item,this).options,this.reference)for(var e in this.options)this.options[e].image=this.options[e][this.reference];return t.render("berry_"+(this.elType||this.type),this)},setup:function(){this.$el=this.self.find(".list-group"),this.$el.children(".list-group-item").off(),this.$el.children(".list-group-item").on("click",e.proxy(function(t){this.$el.children(".list-group-item-success").removeClass("list-group-item-success"),e(t.target).closest(".list-group-item").addClass("list-group-item-success"),"function"==typeof this.onchange&&this.onchange(),this.trigger("change")},this))},getValue:function(){return this.$el.children(".list-group-item-success").attr("data-value")},setValue:function(t){return this.$el.children('[data-value="'+t+'"]').click()}})}(Berry,jQuery); !function(t,i){t.register({type:"dropdown",create:function(){return this.options=t.processOpts.call(this.owner,this.item,this).options,t.render("berry_"+(this.elType||this.type),this)},setup:function(){this.$el=this.self.find(".btn-group"),this.$el.find("a").on("click",i.proxy(function(t){t.preventDefault(),this.setValue(i(t.target).data("value")),this.trigger("change"),void 0!==this.onchange&&this.onchange()},this))},setValue:function(t){return this.$el.find("ul").attr("data-value",t),this.$el.find("button").html(this.displayAs(t)+' <span class="caret"></span>')},getValue:function(){return this.$el.find("ul").attr("data-value")},displayAs:function(t){for(var i in this.options)if(this.options[i].value==(t||this.value))return this.options[i].label}})}(Berry,jQuery); !function(t,e){t.register({type:"grid_select",defaults:{select_class:"text-info"},create:function(){this.options=t.processOpts.call(this.owner,this.item,this).options;for(var e in this.options)this.options[e].image=this.options[e][this.value_key||"value"];return t.render("berry_"+(this.elType||this.type),this)},setup:function(){this.$el=this.self.find(".list"),this.$el.children(".col-md-3").off(),this.$el.children(".col-md-3").on("click",e.proxy(function(t){this.$el.children("."+this.select_class).removeClass(this.select_class),e(t.target).closest(".col-md-3").addClass(this.select_class),"function"==typeof this.onchange&&this.onchange(),this.trigger("change")},this))},getValue:function(){return this.$el.children("."+this.select_class).attr("data-value")},setValue:function(t){return this.$el.children('[data-value="'+t+'"]').click()}})}(Berry,jQuery); !function(e,i){e.register({type:"image_picker","default":{autosize:!0,advanced:!1},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",i.proxy(function(){this.trigger("change")},this)),this.self.find("button,img").on("click",i.proxy(function(){this.modal=i().berry({legend:this.label||"Choose One",fields:{Image:{label:!1,value:this.value,options:this.options,choices:this.choices,value_key:this.value_key,label_key:this.label_key,root:this.path,type:"grid_select"}}}).on("save",function(){this.update({value:this.modal.fields.image.toJSON()}),this.modal.trigger("close")},this)},this))},setValue:function(e){this.value!=e&&this.update({value:e})}})}(Berry,jQuery); !function(t,e){t.register({type:"rateit",create:function(){return t.render("berry_rateit",this)},setup:function(){this.render(),this.$el=this.self.find(".rateit"),this.$el.rateit(),this.$el.rateit("value",this.value),this.$el.bind("rated reset",e.proxy(function(){this.$el.focus(),this.trigger("change"),void 0!==this.onchange&&this.onchange()},this))},setValue:function(t){return this.value=t,this.$el.rateit("value",t)},getValue:function(){return this.$el.rateit("value")},getDisplay:function(){for(var t in this.options)if(this.options[t].value==this.lastSaved)return this.options[t].label;for(var e="",t=1;t<=this.value;t++)e+='<i class="fa fa-star"></i>';var i=Math.floor(this.value);this.value-i>=.5&&(e+='<i class="fa fa-star-half-full"></i>');for(var t=Math.round(this.value);5>t;t++)e+='<i class="fa fa-star-o"></i>';return e}})}(Berry,jQuery); !function(t,e){t.register({type:"upload",defaults:{autosize:!0,advanced:!1},setup:function(){this.$el=this.self.find("form input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",e.proxy(function(){this.trigger("change")},this)),this.myDropzone=new Dropzone("#"+this.name,{method:"post",paramName:this.name,success:e.proxy(function(t,e){this.setValue(e),this.trigger("uploaded")},this)})},getValue:function(){return this.value},setValue:function(t){return"undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.$el},update:function(t,i){"object"==typeof t&&e.extend(this.item,t),e.extend(this,this.item),this.setValue(this.value),this.myDropzone.destroy(),this.render(),this.setup(),i||this.trigger("change")},render:function(){return"undefined"==typeof this.self?this.self=e(this.create()).attr("data-Berry",this.owner.options.name):this.self.find("div:first").replaceWith(e(this.create()).html()),this.display=this.getDisplay(),this.self}})}(Berry,jQuery); Berry.renderers.inline=function(e){this.owner=e,this.fieldset=function(e){Berry.render("berry_base_fieldset",e)},this.render=function(){return $("<div/>")}},Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){"inline"==this.options.renderer&&(this.options.inline=!0,this.options.autoFocus=!1,this.options.default={hideLabel:!0},this.on("initializeField",function(e){if(e.field.item.fieldset=this.$el.find('[data-inline="'+e.field.item.name+'"]'),e.field.item.fieldset.length>1){var i=this.$el.find('[data-inline="'+e.field.item.name+'"][id='+e.field.item.id+"]");i.length>0&&(e.field.item.fieldset=i)}e.field.item.fieldset&&$.extend(e.field.item,e.field.item.fieldset.data())}))}}); Berry.renderers.popins=function(e){this.owner=e,this.fieldset=function(e){Berry.render("berry_base_fieldset",e)},this.render=function(){return $("<div/>")},this.initialize=function(){this.owner.on("destroy",function(){$(".row.form-group[data-berry="+this.options.name+"]").closest(".popover").remove()}),"string"==typeof this.owner.options.popins_template&&this.owner.$el.html(Berry.render(this.owner.options.popins_template,{fields:_.toArray(this.owner.fields)})),this.owner.each(function(e){e.create(this)},[this]),$("body").off("click",".popoverCancel"),$("body").on("click",".popoverCancel",function(){$("[data-popins]").popover("hide");var e=Berry.instances[$(this).data("berry")],o=e.find($(this).data("name"));o.revert(),$('[data-popins="'+$(this).data("name")+'"]').focus()}),$("body").off("click",".popoverSave"),$("body").on("click",".popoverSave",function(){var e=Berry.instances[$(this).data("berry")],o=$(this).data("name"),n=e.find(o);$(n.self).find(".form-control").blur(),e.performValidate(n,n.getValue()),n.valid?(n.toJSON(),e.$el.find('[data-popins="'+o+'"]').focus().html(n.display).popover("hide"),e.trigger("updated"),e.trigger("save")):n.focus()}),$("body").keydown(function(e){switch(e.keyCode){case 27:$(".popover.in .popoverCancel").click();break;case 13:$(".popover.in .popoverSave").click()}}),this.owner.on("loaded",$.proxy(function(){this.owner.each(function(){this.owner.$el.find('[data-popins="'+this.name+'"]').html(this.display)})},this))}},Berry.renderers.popins.prototype.create=function(e){var o=e.owner.$el.find('[data-popins="'+e.name+'"]'),n=$.extend({container:"#"+e.owner.$el.attr("id"),viewport:{selector:"#content",padding:20}},{title:'<div style="padding-left:0"><div class="btn-group pull-right"><div style="margin-left:2px;" class="btn-xs popoverCancel fa fa-times btn btn-danger" data-name="'+e.name+'" data-berry="'+e.owner.options.name+'"></div><div class="btn-xs fa fa-check btn btn-success popoverSave" data-name="'+e.name+'" data-berry="'+e.owner.options.name+'"></div></div></div>'+(e.prompt||e.label),content:e.self,html:!0,placement:"left auto",template:'<div class="popover berry"><div class="arrow"></div><h3 class="popover-title"></h3><div style="min-width:270px" class="popover-content"></div></div>'},e.owner.options.popins,e.popins);o.popover(n),o.on("hidden.bs.popover",function(){$(".berry.popover").css({display:"none"})}),o.on("show.bs.popover",function(){$(".popover.in .popoverCancel").click()}),o.on("shown.bs.popover",function(){var e=Berry.instances[$(".berry.popover").find(".row").data("berry")].find($(".berry.popover").find(".row").attr("name"));e.initialize(),e.focus()})},Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){"popins"==this.options.renderer&&(this.options.default={hideLabel:!0},this.options.inline=!0,$.extend(this.options.default,{hideLabel:!0}))}}); Berry.renderers.tabs=function(e){this.owner=e,this.fieldset=function(e){return null===e.parent?Berry.render("berry_tabs_fieldset",e):Berry.render("berry_base_fieldset",e)},this.render=function(){return this.owner.$el.html(Berry.render("berry_base_form",this.owner.options)),this.owner.$el.find("form")},this.initialize=function(){this.owner.options.tabsTarget?this.owner.on("destroy",function(){this.options.tabsTarget.empty()}):this.owner.options.tabsTarget=this.owner.$el,this.owner.options.tabsTarget.prepend(Berry.render("berry_tabs",this.owner)).find("a:first").tab("show")}},Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){"tabs"==this.options.renderer&&(this.sectionsEnabled=!0,this.options.modifiers+=" tab-content")}}); Berry.renderers.wizard=function(t){this.owner=t,this.fieldset=function(t){return Berry.render("berry_"+this.owner.options.renderer+"_fieldset",t)},this.render=function(){return this.owner.$el.html(Berry.render("berry_"+this.owner.options.renderer+"_form",this.owner.options)),this.owner.$el.find("form")},this.$element=null,this.update=function(){this.$element.find("ul").html(Berry.render("berry_wizard_steps",this.owner)),$("[data-id=berry-submit],[data-id=wizard-next]").hide(),$(".step-pane").removeClass("active"),$("#step"+(this.owner.currentSection+1)).addClass("active"),this.owner.currentSection+1!=this.owner.section_count?$("[data-id=wizard-next]").show():$("[data-id=berry-submit]").show(),0===this.owner.currentSection?$("[data-id=wizard-previous]").hide():$("[data-id=wizard-previous]").show(),this.$element.find("ul").first().attr("style","margin-left: 0");var t=0;this.$element.find("ul > li").each(function(){t+=$(this).outerWidth()});var e=0;if(e=this.$element.find(".actions").length?this.$element.width()-this.$element.find(".actions").first().outerWidth():this.$element.width(),t>e){var i=t-e;this.$element.find("ul").first().attr("style","margin-left: -"+i+"px"),this.$element.find("li."+this.owner.sectionList[this.owner.currentSection].state).first().position().left<200&&(i+=this.$element.find("li."+this.owner.sectionList[this.owner.currentSection].state).first().position().left-200,1>i?this.$element.find("ul").first().attr("style","margin-left: 0"):this.$element.find("ul").first().attr("style","margin-left: -"+i+"px"))}},this.next=function(){this.owner.valid=!0,this.owner.toJSON(),this.owner.each(this.owner.validateItem,null,this.owner.sections[this.owner.currentSection].children),this.owner.valid?this.owner.currentSection<this.owner.section_count-1&&(this.owner.sectionList[this.owner.currentSection].state="complete",this.owner.currentSection++,this.owner.clearErrors(),this.owner.sectionList[this.owner.currentSection].state="active"):this.owner.sectionList[this.owner.currentSection].state="error",this.update()},this.previous=function(){this.owner.currentSection>0&&(this.owner.sectionList[this.owner.currentSection].state="disabled",this.owner.currentSection--,this.owner.sectionList[this.owner.currentSection].state="active"),this.update()},this.sectionClick=function(t){var e=parseInt($(t.currentTarget).data("target").replace("#step",""),10)-1;if(e<this.owner.currentSection){for(var i=e;i<=this.owner.currentSection;i++)this.owner.sectionList[i].state="disabled";this.owner.currentSection=e,this.owner.sectionList[this.owner.currentSection].state="active"}this.update()},this.initialize=function(){this.owner.sectionList[0].state="active",this.owner.currentSection=0,this.owner.currentSection+1==this.owner.section_count?$("[data-id=wizard-next]").hide():$("[data-id=berry-submit]").hide(),0===this.owner.currentSection?$("[data-id=wizard-previous]").hide():$("[data-id=wizard-previous]").show(),this.$element=this.owner.$el.find(".wizard"),this.$element.find("ul").html(Berry.render("berry_wizard_steps",this.owner)),$("#step1").addClass("active"),$("body").on("click",".wizard li",$.proxy(this.sectionClick,this)),$("body").on("click","[data-id=wizard-next]",$.proxy(this.next,this)),$("body").on("click","[data-id=wizard-previous]",$.proxy(this.previous,this))}},Berry.btn.previous={label:"Previous",icon:"arrow-left",id:"wizard-previous",modifier:"danger pull-left"},Berry.btn.next={label:"Next",icon:"arrow-right",id:"wizard-next",modifier:"success pull-right"},Berry.btn.finish=$.extend({},Berry.btn.save,{label:"Finish"}),Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){"wizard"==this.options.renderer&&(this.sectionsEnabled=!0,this.options.actions=["finish","next","previous"])}});
